<%- include('layout', { title: title }) %>

<div class="category-page">
    <h2>Kategori: <%= category %></h2>
    
    <% if (products.length === 0) { %>
        <div class="no-products">
            <p>Tidak ada produk dalam kategori ini</p>
            <a href="/" class="btn-primary">Kembali ke Home</a>
        </div>
    <% } else { %>
        <div class="produk-grid">
            <% products.forEach(product => { %>
            <div class="produk">
                <img src="/img/<%= product.gambar %>" alt="<%= product.nama_produk %>">
                <h4><%= product.nama_produk %></h4>
                <p>Rp <%= product.harga.toLocaleString('id-ID') %></p>
                <a href="/product/<%= product.id %>" class="btn-view">Lihat Detail</a>
                <button class="btn-add-cart" data-product-id="<%= product.id %>">Tambahkan ke Troli</button>
            </div>
            <% }); %>
        </div>
    <% } %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addToCartButtons = document.querySelectorAll('.btn-add-cart');
    
    addToCartButtons.forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            
            fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productId: productId,
                    quantity: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                } else {
                    alert(data.message);
                    if (data.message.includes('login')) {
                        window.location.href = '/auth/login';
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan');
            });
        });
    });
});
</script>
